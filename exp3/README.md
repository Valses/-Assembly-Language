##实验目的与要求

(1)熟悉汇编语言指令的特点，掌握代码优化的基本方法；

(2)理解高级语言程序与汇编语言程序之间的对应关系。

##实验内容

任务1. 观察多重循环对CPU计算能力消耗的影响

若有m个用户在同一台电脑上排队使用实验二的程序，想要查询“wangwu”这个学生的平均成绩，那就相当于将实验二的程序执行了m次。为了观察从第一个用户开始进入查询至第m个用户查到结果之间到底延迟了多少时间，我们让实验二的功能二和功能三的代码重复执行m次，通过计算这m次循环执行前和执行后的时间差，来感受其影响。由于功能一和功能四需要输入、输出，速度本来就较慢，所以，没有纳入到这m次循环体内（但可以保留不变）。请按照上述设想修改实验二的程序，并将m值尽量取大（建议m>=1000），以得到较明显的效果。

提示: 只计m次循环开始的时间和结束的时间。

学校汇编教学网站的软件下载中提供了显示当前时间“秒和百分秒”的子程序。若在m次循环前调用一下该子程序，m次循环执行完之后再调用一下该子程序，就能在屏幕上观察并感受到执行循环前后的时间差（时间差值需要自行手工计算）。注意，由于虚拟机环境下CPU会被分时调度，故该时间差值会因计算机运行环境与状态的不同而不同。

任务2. 对任务1中的汇编源程序进行优化

优化工作包括代码长度的优化和执行效率的优化，本次优化的重点是执行效率的优化。请通过优化m次循环体内的程序，使程序的执行时间减少10%以上。减少的越多，评价越高！

优化方法提示：首先是通过选择执行速度较快的指令来提高性能，比如，把乘除指令转换成移位指令、加法指令等；其次，内循环体中每减少一条指令，就相当于减少了m*n条指令的执行时间，需要仔细斟酌；第三，尽量采用32位寄存器寻址，能有更多的机会提高指令执行效率。

任务3. 观察用C语言实现的任务1的程序与汇编语言实现的程序的差异

首先确定自己实现的任务1程序中的m与n的值与老师提供的C语言程序中的对应值是一样的【老师提供的C语言源程序ex3.c仅仅实现了功能二和三，其对应的执行程序是ex3D.exe（缺省设置版）和ex3F.exe（执行速度优化版），在学校汇编教学网站的实验指导中下载】，然后对比两种语言实现的程序的执行效率和代码长度。通过用TD等工具反汇编执行程序ex3D.exe和ex3F.exe，观察和总结C语言编写程序和自己的汇编语言程序的对应关系及差异，总结其中可以简化的地方，以优化代码长度和执行效率。

提示：采用反汇编方法观察C语言编写生成的执行程序时，首先观察程序的整体结构特点，然后重点分析、比较计算平均成绩的程序代码Average()。若你的计算机执行速度很快，需要加大程序中的循环次数m的值，则除了可采用修改源程序，然后再编译连接的方法实现外，还可以使用TD直接在内存中去修改执行程序中的m值的方法实现。
